<mat-toolbar color="primary">
  <span>Call Center Bookings</span>
  <span class="spacer"></span>
  <button mat-icon-button (click)="refreshBookings()">
    <mat-icon>refresh</mat-icon>
  </button>
</mat-toolbar>

<div class="container">
  <mat-card>
    <mat-card-header>
      <mat-card-title>Booking List</mat-card-title>
    </mat-card-header>
    <mat-card-content>
      <div class="communication-buttons" *ngIf="userRole">
        <a mat-raised-button color="accent" [href]="getCallLink()" target="_blank">
          <mat-icon>call</mat-icon> Call Twilio
        </a>
        <a mat-raised-button color="accent" [href]="getMessageLink()" target="_blank">
          <mat-icon>message</mat-icon> Message Twilio
        </a>
        <a mat-raised-button color="accent" [href]="getWhatsAppLink()" target="_blank">
          <mat-icon>whatsapp</mat-icon> WhatsApp Twilio
        </a>
      </div>

      <div *ngIf="bookings$ | async as bookings; else loading">
        <div *ngIf="bookings.length > 0; else noBookings">
          <table mat-table [dataSource]="bookings" class="mat-elevation-z8 full-width-table">

            <!-- ID Column -->
            <ng-container matColumnDef="id">
              <th mat-header-cell *matHeaderCellDef> ID </th>
              <td mat-cell *matCellDef="let booking"> {{ booking.id }} </td>
            </ng-container>

            <!-- Date & Time Column -->
            <ng-container matColumnDef="pickupDateTime">
              <th mat-header-cell *matHeaderCellDef> Date & Time </th>
              <td mat-cell *matCellDef="let booking"> {{ booking.pickupDateTime | date:'medium' }} </td>
            </ng-container>

            <!-- Pickup Location Column -->
            <ng-container matColumnDef="pickupLocation">
              <th mat-header-cell *matHeaderCellDef> Pickup Location </th>
              <td mat-cell *matCellDef="let booking"> {{ booking.pickupLocation }} </td>
            </ng-container>

            <!-- Drop-off Location Column -->
            <ng-container matColumnDef="dropoffLocation">
              <th mat-header-cell *matHeaderCellDef> Drop-off Location </th>
              <td mat-cell *matCellDef="let booking"> {{ booking.dropoffLocation }} </td>
            </ng-container>

            <!-- Passengers Column -->
            <ng-container matColumnDef="passengers">
              <th mat-header-cell *matHeaderCellDef> Passengers </th>
              <td mat-cell *matCellDef="let booking"> {{ booking.passengers }} </td>
            </ng-container>

            <!-- Phone Number Column -->
            <ng-container matColumnDef="phoneNumber">
              <th mat-header-cell *matHeaderCellDef> Phone Number </th>
              <td mat-cell *matCellDef="let booking"> {{ booking.phoneNumber }} </td>
            </ng-container>

            <!-- Status Column -->
            <ng-container matColumnDef="status">
              <th mat-header-cell *matHeaderCellDef> Status </th>
              <td mat-cell *matCellDef="let booking">
                <span class="status" [ngClass]="booking.status.toLowerCase()">{{ booking.status }}</span>
              </td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
          </table>
        </div>
      </div>

      <ng-template #loading>
        <mat-spinner diameter="30"></mat-spinner>
        <p>Loading bookings...</p>
      </ng-template>

      <ng-template #noBookings>
        <p>No bookings have been made yet.</p>
      </ng-template>
    </mat-card-content>
  </mat-card>
</div>
